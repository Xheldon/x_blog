<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>ä½¿ç”¨ Sharp è½¬æ¢ HEIC/HEIF å›¾ç‰‡é‡åˆ°çš„é—®é¢˜ - Xheldon Blog</title>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="EX6ES0UVArXTvp5aeeWrkXGn5M5MZ10bYqXanXDEzAs" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    
        <meta name="description" content="è®°å½•ä½¿ç”¨ Sharp å‹ç¼© HEIC æ ¼å¼å›¾ç‰‡æ—¶é‡åˆ°çš„é—®é¢˜å’Œè§£å†³çš„è¿‡ç¨‹">
    
    <meta name="keywords"  content="Xheldon, ç”Ÿæ´», ç¾é£Ÿ, æ—…æ¸¸, å‰ç«¯, æŠ€æœ¯, åˆ†äº«">
    <meta name="theme-color" content="#000000">
    <meta name="twitter:card" content="summary_large_image">
    <!-- Open Graph -->
    <meta property="og:title" content="ä½¿ç”¨ Sharp è½¬æ¢ HEIC/HEIF å›¾ç‰‡é‡åˆ°çš„é—®é¢˜ - Xheldon Blog">
    
    <meta property="og:type" content="article">
    
    <meta property="article:published_time" content="2023-01-05T12:06:50Z">
    
    
    
    <meta property="article:tag" content="æŠ€æœ¯">
    
    <meta property="article:tag" content="æ ¼å¼">
    
    <meta property="article:tag" content="è½¬æ¢">
    
    <meta property="article:tag" content="å‹ç¼©">
    
    <meta property="article:tag" content="å¼€æº">
    
    
    
        <meta name="og:description" content="è®°å½•ä½¿ç”¨ Sharp å‹ç¼© HEIC æ ¼å¼å›¾ç‰‡æ—¶é‡åˆ°çš„é—®é¢˜å’Œè§£å†³çš„è¿‡ç¨‹">
    
    
    <meta property="twitter:image" content="https://static.xheldon.cn/img/in-post/2023/problem-use-sharp/photo-1603468620905-8de7d86b781e.webp">
    <meta property="og:image" content="https://static.xheldon.cn/img/in-post/2023/problem-use-sharp/photo-1603468620905-8de7d86b781e.webp">
    
    <meta property="og:url" content="https://www.xheldon.com/tech/problem-use-sharp.html">
    <meta property="og:site_name" content="Xheldon Blog">
    <meta name="google-adsense-account" content="ca-pub-5486286026923411">
    <script async src="https://fundingchoicesmessages.google.com/i/pub-5486286026923411?ers=1" nonce="hkl-3cDcQhqR8uwDMTDGjQ"></script><script nonce="hkl-3cDcQhqR8uwDMTDGjQ">(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5486286026923411"
     crossorigin="anonymous"></script>
    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/resources/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.xheldon.com/tech/problem-use-sharp.html">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://static.xheldon.cn/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="https://static.xheldon.cn/css/xheldon-life-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <link href="https://static.xheldon.cn/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">
                    Xheldon Blog
                </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div id="xheldonblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="/">Home</a></li>
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        <li>
                            <a href="/donate/">Donate</a>
                        </li>
                        <li>
                            <a href="/archive/">Archive</a>
                        </li>
                        <li>
                            <a href="/feed.xml">Rss</a>
                        </li>
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <script>
        // Drop Bootstarp low-performance Navbar
        // Use customize navbar with high-quality material design animation
        // in high-perf jank-free CSS3 implementation
        var $body = document.body;
        var $toggle = document.querySelector('.navbar-toggle');
        var $navbar = document.querySelector('#xheldonblog_navbar');
        var $collapse = document.querySelector('.navbar-collapse');

        var __XheldonNav__ = {
            close: function () {
                $navbar.className = " ";
                // wait until animation end.
                setTimeout(function () {
                    // prevent frequently toggle
                    if ($navbar.className.indexOf('in') < 0) {
                        $collapse.style.height = "0px"
                    }
                }, 400)
            },
            open: function () {
                $collapse.style.height = "auto"
                $navbar.className += " in";
            }
        }

        // Bind Event
        $toggle.addEventListener('click', function (e) {
            if ($navbar.className.indexOf('in') > 0) {
                __XheldonNav__.close()
            } else {
                __XheldonNav__.open()
            }
        })

        /**
         * Since Fastclick is used to delegate 'touchstart' globally
         * to hack 300ms delay in iOS by performing a fake 'click',
         * Using 'e.stopPropagation' to stop 'touchstart' event from 
         * $toggle/$collapse will break global delegation.
         * 
         * Instead, we use a 'e.target' filter to prevent handler
         * added to document close XheldonNav.  
         *
         * Also, we use 'click' instead of 'touchstart' as compromise
         */
        document.addEventListener('click', function (e) {
            if (e.target == $toggle) return;
            if (e.target.className == 'icon-bar') return;
            __XheldonNav__.close();
        })
    </script>
    <!-- Search -->
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

    <!-- Image to hack wechat -->
<!-- <img src="/resources/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/in-post/2023/problem-use-sharp/photo-1603468620905-8de7d86b781e.webp" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('https://static.xheldon.cn/img/in-post/2023/problem-use-sharp/photo-1603468620905-8de7d86b781e.webp');
        
    }

    
    header.intro-header .header-mask{
        width: 100%;
        height: 100%;
        position: absolute;
        background: rgba(0,0,0, 0.4);
    }
    
</style>

<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="header-img-credit">
        Image by <a href="https://unsplash.com/@ryland_dean?utm_source=xheldon_blog&utm_medium=referral" target="_blank">Ryland Dean / Unsplash</a>
    </div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=%E6%8A%80%E6%9C%AF" title="æŠ€æœ¯">æŠ€æœ¯</a>
                        
                        <a class="tag" href="/archive/?tag=%E6%A0%BC%E5%BC%8F" title="æ ¼å¼">æ ¼å¼</a>
                        
                        <a class="tag" href="/archive/?tag=%E8%BD%AC%E6%8D%A2" title="è½¬æ¢">è½¬æ¢</a>
                        
                        <a class="tag" href="/archive/?tag=%E5%8E%8B%E7%BC%A9" title="å‹ç¼©">å‹ç¼©</a>
                        
                        <a class="tag" href="/archive/?tag=%E5%BC%80%E6%BA%90" title="å¼€æº">å¼€æº</a>
                        
                    </div>
                    <h1>ä½¿ç”¨ Sharp è½¬æ¢ HEIC/HEIF å›¾ç‰‡é‡åˆ°çš„é—®é¢˜</h1>
                    
                    <h2 class="subheading"></h2>
                    <span class="meta">âœğŸ¼ å†™äº 2023å¹´01æœˆ05æ—¥</span>&nbsp;&nbsp;&nbsp;  
                    
                    <span class="meta">ğŸ’¡ æ›´æ–°äº 2023å¹´01æœˆ09æ—¥</span>
                    
                </div>
            </div>
        </div>
    </div>
</header>






<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                
                
                    
                        
                        <div class="time-tips">â—ï¸&nbsp;æ³¨æ„ï¼šç¦»æœ¬æ–‡åˆ›å»ºæ—¶é—´å·²ç»è¿‡å»äº† <code id="from_time"></code> å¤©ï¼Œè¯·æ³¨æ„æ—¶æ•ˆæ€§</div>
                        <script>
                            var timeDom = document.getElementById('from_time');
                            var pageTime = 1672891610; // Note: è§ ruby çš„ time parser: https://ruby-doc.org/stdlib-3.0.2/libdoc/time/rdoc/Time.html#method-c-parse
                            var currentTime = Date.now();
                            var fromNow = ((currentTime - (pageTime * 1000)) / (24 * 3600 * 1000)).toFixed(0);
                            if (Number(fromNow) <= 0) {
                                fromNow = 1; // Note: è‡³å°‘æ˜¾ç¤ºä¸€å¤©
                            }
                            timeDom.innerText = fromNow
                        </script>
                    
                    
                
                
                    <div class="callout-tips">ğŸ–¥ &nbsp;è¯´æ˜ï¼šè®°å½•ä½¿ç”¨ Sharp å‹ç¼© HEIC æ ¼å¼å›¾ç‰‡æ—¶é‡åˆ°çš„é—®é¢˜å’Œè§£å†³çš„è¿‡ç¨‹</div>
                
                
                    <div class="craft-tips">ğŸ“š &nbsp;æœ¬æ–‡åŒæ­¥å‘å¸ƒåœ¨ Craftï¼š<a href="https://www.craft.do/s/mHmLa16eR5YWPi" target="_blank">https://www.craft.do/s/mHmLa16eR5YWPi</a></div>
                
                
				<p>è‹¹æœç›¸æœºåœ¨ iOS 11 ä¹‹åï¼Œå°†ç›¸æœºé»˜è®¤çš„æ ¼å¼è®¾ç½®ä¸ºäº† HEICï¼Œæ®è¯´å¯ä»¥åœ¨ä¸ç¼©å‡ç…§ç‰‡è´¨é‡çš„å‰æä¸‹ï¼Œå¤§å¹…ç¼©å‡ç…§ç‰‡ä½“ç§¯ï¼Œä½ å¯ä»¥åœ¨ <code class="language-plaintext highlighter-rouge">è®¾ç½®-ç›¸æœº-æ ¼å¼</code>  æ¥æŸ¥çœ‹ï¼Œã€Œé«˜æ•ˆã€è¡¨ç¤ºçš„å°±æ˜¯ HEIC æ ¼å¼ï¼Œã€Œå…¼å®¹æ€§æœ€ä½³ã€è¡¨ç¤ºçš„æ˜¯åŸå§‹çš„ JEPG æ ¼å¼ã€‚å…³äº HEIC æ ¼å¼æ›´å¤šä»‹ç»å¯ä»¥çœ‹ <a href="https://www.adobe.com/hk_zh/creativecloud/file-types/image/raster/heic-file.html">è¿™é‡Œ</a>ã€‚</p>

<p>ç”±æ­¤å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œç›®å‰æ‰€æœ‰çš„ Web æµè§ˆå™¨éƒ½ä¸æ”¯æŒæ˜¾ç¤º HEIC æ ¼å¼çš„å›¾ç‰‡ï¼Œå› æ­¤å¦‚ä½•è½¬æ¢è¯¥æ ¼å¼çš„å›¾ç‰‡å°±æˆä¸ºäº†ä¸€ä¸ªé—®é¢˜ã€‚</p>

<p>æˆ‘ç»å¸¸å°†è‹¹æœç›¸å†Œä¸­çš„å›¾ç‰‡ç›´æ¥ä»ç›¸å†Œä¸­æ‹–æ‹½æˆ–å¤åˆ¶ç²˜è´´åˆ° Craft ä¸­ï¼Œå› æ­¤å¦‚æœç›´æ¥å°†è¯¥æ ¼å¼çš„å›¾ç‰‡ä¸Šä¼ åˆ°ä¸ªäººåšå®¢çš„è¯ï¼Œæ˜¯æ— æ³•æ˜¾ç¤ºå‡ºæ¥çš„ï¼Œå› æ­¤å¿…é¡»è½¬æ¢æˆé€šç”¨æ ¼å¼å¦‚ PNG æˆ–è€… JPEGï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨ Sharp åº“è¿›è¡Œè½¬æ¢ï¼Œå°†å…¶è½¬æ¢æˆäº† Webpï¼ˆå› ä¸º HEIC è½¬ PNG å¤ªå¤§äº†ï¼‰ã€‚</p>

<p><a class="link-bookmark" href="https://github.com/lovell/sharp" target="_blank"><span data-bookmark-img="https://repository-images.githubusercontent.com/12226786/cf816100-9a08-11ea-8fc1-7af9d4bcbf9e" data-bookmark-title="G"><img src="https://repository-images.githubusercontent.com/12226786/cf816100-9a08-11ea-8fc1-7af9d4bcbf9e" /></span><span><span>GitHub - lovell/sharp: High performance Node.js image processing, the fastest module to resize JPEG, PNG, WebP, AVIF and TIFF images. Uses the libvips library.</span><span>
High performance Node.js image processing, the fastest module to resize JPEG, PNG, WebP, AVIF and TIFF images. Uses the libvips library. - GitHub - lovell/sharp: High performance Node.js image proc...
</span><span>https://github.com/lovell/sharp</span></span></a></p>

<p>å¦‚æœä»…ä»…è½¬æ¢æ™®é€šçš„æ ¼å¼å¦‚ JPEG åˆ° PNGï¼Œé‚£ä¹ˆæ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœæ˜¯è½¬æ¢ HEIC åˆ°å…¶ä»–æ ¼å¼ï¼Œé‚£éº»çƒ¦å°±æ¥äº†ï¼Œå› ä¸ºè¿™ä¸ªè¿‡ç¨‹ Sharp ä¾èµ–ä¸€ä¸ªå¹³å°åŸç”Ÿçš„å·¥å…·åº“ï¼Œå« <code class="language-plaintext highlighter-rouge">libvips</code> ï¼š</p>

<p><a class="link-bookmark" href="https://github.com/libvips/libvips" target="_blank"><span data-bookmark-img="https://opengraph.githubassets.com/5394d24c340a30dc1be077d37b0ca91234b63a95da32e047fb04ad05dd2ae075/libvips/libvips" data-bookmark-title="G"><img src="https://opengraph.githubassets.com/5394d24c340a30dc1be077d37b0ca91234b63a95da32e047fb04ad05dd2ae075/libvips/libvips" /></span><span><span>GitHub - libvips/libvips: A fast image processing library with low memory needs.</span><span>
A fast image processing library with low memory needs. - GitHub - libvips/libvips: A fast image processing library with low memory needs.
</span><span>https://github.com/libvips/libvips</span></span></a></p>

<p>æ¥å¤„ç† HEIC æ ¼å¼çš„æ–‡ä»¶ï¼Œå› æ­¤å¦‚æœä½ æœ¬åœ°æ²¡æœ‰å…¨å±€å®‰è£…è¿™ä¸ªå·¥å…·ï¼Œé‚£ä¹ˆå¤„ç† HEIC æ ¼å¼çš„å›¾ç‰‡çš„æ—¶å€™å°±ä¼šé‡åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š</p>

<pre><code class="language-Bash">(node:11469) UnhandledPromiseRejectionWarning: Error: source: bad seek to 807962
heif: Unsupported feature: Unsupported codec (4.3000)

(Use `node --trace-warnings ...` to show where the warning was created)
(node:11469) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 1)
</code></pre>

<p>è¯´æ˜¯æ— æ³•å¤„ç† HEIC æ ¼å¼çš„æ–‡ä»¶ã€‚</p>

<p>é‡åˆ°é—®é¢˜ç¬¬ä¸€æ—¶é—´å½“ç„¶æ˜¯å»å®˜æ–¹ä»“åº“çš„ issue æŸ¥æ‰¾ç›¸å…³è§£å†³åŠæ³•ï¼Œæœç„¶æœ‰äººé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼š</p>

<p><a class="link-bookmark" href="https://github.com/lovell/sharp/issues/2924" target="_blank"><span data-bookmark-img="https://opengraph.githubassets.com/022362ae50e0768004484655f96c2c5963ddea524e5b6031321cd081658b204a/lovell/sharp/issues/2924" data-bookmark-title="H"><img src="https://opengraph.githubassets.com/022362ae50e0768004484655f96c2c5963ddea524e5b6031321cd081658b204a/lovell/sharp/issues/2924" /></span><span><span>heif: unsupported feature Â· Issue #2924 Â· lovell/sharp</span><span>
Are you using the latest version? Is the version currently in use as reported by npm ls sharp the same as the latest version as reported by npm view sharp dist-tags.latest? 2.9.1 What are the steps...
</span><span>https://github.com/lovell/sharp/issues/2924</span></span></a></p>

<p>äºæ˜¯æŒ‰ç…§ä»–çš„è¯´æ³•ï¼Œæˆ‘ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">homebrew</code> å®‰è£…äº† <code class="language-plaintext highlighter-rouge">libvips</code> :</p>

<p><a class="link-bookmark" href="https://www.libvips.org/install.html" target="_blank"><span data-bookmark-img="https://www.libvips.org/install.html/favicon.ico" data-bookmark-title="L"><img src="https://www.libvips.org/install.html/favicon.ico" /></span><span><span>libvips</span><span>
"A fast image processing library with low memory needs."
</span><span>https://www.libvips.org/install.html</span></span></a></p>

<p>è¿™ä¸ªè¿‡ç¨‹éœ€è¦æŒºä¹…ï¼Œä¼šä¸€ç›´æœ‰ log å‡ºç°ï¼Œè€å¿ƒç­‰å¾…å®Œæˆæ— æŠ¥é”™å³å¯ã€‚</p>

<p>ç„¶åæ»¡æ€€ä¿¡å¿ƒçš„å†æ¬¡å®‰è£… Sharp <code class="language-plaintext highlighter-rouge">npm install sharp</code> æœŸå¾…èƒ½çœ‹åˆ°è¿™æ¡ä¿¡æ¯ï¼š</p>

<pre><code class="language-Bash">sharp: Detected globally-installed libvips v8.13.3
</code></pre>

<p>å‡ºç°è¿™æ¡ä¿¡æ¯è¡¨æ˜ Sharp çš„å®‰è£…è„šæœ¬æ£€æµ‹åˆ°æœ¬åœ°å®‰è£…äº† libvipsï¼Œä½†æ˜¯å½“æˆ‘å†æ¬¡å®‰è£… Sharp çš„æ—¶å€™ï¼Œå®ƒä¾ç„¶ç”¨çš„æ˜¯å·²ç»ä¸‹å¥½çš„ç¼“å­˜:</p>

<pre><code class="language-Bash">&gt; sharp@0.31.3 install /Users/x/Code/test2/node_modules/sharp
&gt; (node install/libvips &amp;&amp; node install/dll-copy &amp;&amp; prebuild-install) || (node install/can-compile &amp;&amp; node-gyp rebuild &amp;&amp; node install/dll-copy)

sharp: Using cached /Users/x/.npm/_libvips/libvips-8.13.3-darwin-x64.tar.br
sharp: Integrity check passed for darwin-x64
npm notice created a lockfile as package-lock.json. You should commit this file.
npm WARN test2@1.0.0 No description
npm WARN test2@1.0.0 No repository field.

added 45 packages from 206 contributors and audited 45 packages in 4.5s

10 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
</code></pre>

<p>äºæ˜¯æˆ‘åˆ é™¤äº†ä¸Šé¢ log ä¸­ç¼“å­˜çš„æ–‡ä»¶ <code class="language-plaintext highlighter-rouge">rm -rf /Users/x/.npm/_libvips/</code> ç›®å½•ï¼Œç„¶åå†æ¬¡æ‰§è¡Œï¼Œä¾ç„¶ æ— æ³•ä½¿ç”¨ç³»ç»Ÿç‰ˆæœ¬çš„ libvipsï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="o">&gt;</span> sharp@0.31.3 <span class="nb">install</span> /Users/x/Code/test2/node_modules/sharp
<span class="o">&gt;</span> <span class="o">(</span>node <span class="nb">install</span>/libvips <span class="o">&amp;&amp;</span> node <span class="nb">install</span>/dll-copy <span class="o">&amp;&amp;</span> prebuild-install<span class="o">)</span> <span class="o">||</span> <span class="o">(</span>node <span class="nb">install</span>/can-compile <span class="o">&amp;&amp;</span> node-gyp rebuild <span class="o">&amp;&amp;</span> node <span class="nb">install</span>/dll-copy<span class="o">)</span>

sharp: Downloading https://github.com/lovell/sharp-libvips/releases/download/v8.13.3/libvips-8.13.3-darwin-x64.tar.br
sharp: Integrity check passed <span class="k">for </span>darwin-x64
npm notice created a lockfile as package-lock.json. You should commit this file.
npm WARN test2@1.0.0 No description
npm WARN test2@1.0.0 No repository field.

added 45 packages from 206 contributors and audited 45 packages <span class="k">in </span>10.727s

10 packages are looking <span class="k">for </span>funding
  run <span class="sb">`</span>npm fund<span class="sb">`</span> <span class="k">for </span>details

found 0 vulnerabilities
</pre></td></tr></tbody></table></code></pre></div></div>

<p>äºæ˜¯æˆ‘å†³å®š debug è¿™ä¸ªåŒ…ã€‚</p>

<p>é¦–å…ˆä» log å¼€å§‹ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªçœ‹ä¸Šå»åƒæ˜¯ç‰ˆæœ¬åˆ¤æ–­çš„ logï¼Œå¦‚ <code class="language-plaintext highlighter-rouge">Using cached</code> ä½œä¸ºå…³é”®å­—ï¼Œåœ¨ <code class="language-plaintext highlighter-rouge">node_modules/sharp</code> åŒ…ä¸­æœç´¢ç›¸å…³å…³é”®å­—ï¼Œåœ¨ <code class="language-plaintext highlighter-rouge">sharp/install/libvips.js</code> ä¸­å‘ç°å¦‚ä¸‹ä»£ç ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">libvips</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Using cached </span><span class="p">${</span><span class="nx">tarPathCache</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>äºæ˜¯ç»§ç»­å¯»æ‰¾ï¼Œå‘ç°è¿™ä¸ªå‡½æ•°é¡¶ä¸Šæœ‰ä¸€ä¸ªå†³å®šæ˜¯ä½¿ç”¨ç³»ç»Ÿå†…ç½®çš„ libvips è¿˜æ˜¯å®ƒè‡ªå·±ç¼–è¯‘çš„ä¸æ”¯æŒ HEIC æ ¼å¼çš„äºŒè¿›åˆ¶åŒ…çš„é€»è¾‘ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">useGlobalLibvips</span> <span class="o">=</span> <span class="nx">libvips</span><span class="p">.</span><span class="nx">useGlobalLibvips</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>åŸºæœ¬å°±æ˜¯è¿™é‡Œäº†ï¼Œdebug äº†è¿™ä¸ªå‡½æ•°ï¼Œå‘ç°åœ¨åˆ¤æ–­ <code class="language-plaintext highlighter-rouge">isRosetta</code> çš„æ—¶å€™ï¼Œè¿”å›äº† trueã€‚å‘ç°å¦‚æœæ˜¯è¿”å› falseï¼Œå°±ä¼šä½¿ç”¨ç³»ç»Ÿå†…ç½®çš„ libvipsï¼Œå¦åˆ™å°±ä½¿ç”¨å®ƒè‡ªå·±ç¼–è¯‘çš„ libvipsï¼š</p>

<p caption="Image"><img src="https://static.xheldon.cn/img/in-post/2023/problem-use-sharp/ACF229E4-D77E-46AD-B1D2-98A4AA970669_2.webp" alt="Image" title="Image" /></p>

<p>è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªå¥‡æ€ªçš„æƒ…å†µæ˜¯ï¼Œåœ¨ debug çš„æ—¶å€™ï¼Œprocess.arch è¾“å‡ºçš„æ˜¯ <code class="language-plaintext highlighter-rouge">x64</code> ï¼Œä¸” log è¿™ä¸ªä»£ç è¾“å‡ºçš„æ˜¯ <code class="language-plaintext highlighter-rouge">sysctl.proc_translated: 1</code> ï¼š</p>

<p caption="Image"><img src="https://static.xheldon.cn/img/in-post/2023/problem-use-sharp/A0492569-B12D-45B5-B05B-40B5DB1B7459_2.webp" alt="Image" title="Image" /></p>

<p>ä½†æ˜¯ç›´æ¥åœ¨æ§åˆ¶å°æ‰§è¡Œè¯¥ä»£ç ï¼Œè¾“å‡ºçš„æ˜¯ <code class="language-plaintext highlighter-rouge">sysctl.proc_translated: 0</code> ï¼š</p>

<p caption="Image"><img src="https://static.xheldon.cn/img/in-post/2023/problem-use-sharp/4616C1B5-102F-4A3C-AF71-CC0BA49530AB_2.webp" alt="Image" title="Image" /></p>

<p>è¿™é‡Œæˆ‘å°±å¾—å‡ºç»“è®ºï¼Œè‚¯å®šæ˜¯ node çš„ç‰ˆæœ¬é—®é¢˜å¯¼è‡´äº†å®ƒä½¿ç”¨äº†è‡ªå·±ç¼–è¯‘çš„ libvipsã€‚äºæ˜¯æˆ‘ä½¿ç”¨ nvmï¼Œå°†é»˜è®¤ node ç‰ˆæœ¬åˆ‡æ¢åˆ° arm64 ç‰ˆæœ¬åï¼Œå†æ¬¡æ‰§è¡Œ <code class="language-plaintext highlighter-rouge">npm i sharp</code> ï¼Œé—®é¢˜è§£å†³ã€‚</p>

<p>ä¸‹é¢æ˜¯è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ç”¨åˆ°çš„ä»£ç ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1">// åˆ—å‡º nvm ç‰ˆæœ¬</span>
<span class="nx">nvm</span> <span class="nx">list</span>
<span class="c1">// è¾“å‡ºå½“å‰ç”µè„‘çš„æ¶æ„</span>
<span class="nx">arch</span> <span class="c1">// å¦‚æœè¾“å‡ºçš„æ˜¯ arm64 è¡¨ç¤ºå°±æ˜¯ M1 èŠ¯ç‰‡</span>
<span class="c1">// ä½¿ç”¨æœ€æ–°çš„ç¨³å®šç‰ˆ</span>
<span class="nx">nvm</span> <span class="nx">install</span> <span class="nx">stable</span> <span class="c1">// æˆ‘çš„æœºå™¨ç»™æˆ‘å®‰è£…äº† 19.3.0 çš„ arm64 ç‰ˆæœ¬çš„ node</span>
<span class="c1">// å°†è¯¥ node ä½œä¸ºé»˜è®¤</span>
<span class="nx">nvm</span> <span class="nx">alias</span> <span class="k">default</span> <span class="nx">v19</span><span class="p">.</span><span class="mf">3.0</span>
<span class="c1">// åœ¨å½“å‰ç»ˆç«¯ä½¿ç”¨ 19.3.0 ç‰ˆæœ¬çš„ node</span>
<span class="nx">nvm</span> <span class="nx">use</span> <span class="mf">19.3</span><span class="p">.</span><span class="mi">0</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>éšåç»™ä½œè€…æäº†ä¸ª PRï¼Œæ¥ä¿®æ”¹ isRosetta çš„é€»è¾‘ï¼š</p>

<p><a class="link-bookmark" href="https://github.com/lovell/sharp/pull/3514" target="_blank"><span data-bookmark-img="https://opengraph.githubassets.com/d8057fae9db42e14f5f79afe6224e9e4c3db958ec1bcda4b0e60a839094daa74/lovell/sharp/pull/3514" data-bookmark-title="G"><img src="https://opengraph.githubassets.com/d8057fae9db42e14f5f79afe6224e9e4c3db958ec1bcda4b0e60a839094daa74/lovell/sharp/pull/3514" /></span><span><span>Get real architecture of M1 Mac regardless of Rosetta by Xheldon Â· Pull Request #3514 Â· lovell/sharp</span><span>
Get real architecture of M1 Mac regardless of Rosetta or node version, see #3239
</span><span>https://github.com/lovell/sharp/pull/3514</span></span></a></p>

<p>ä½†æ˜¯ä½œè€…è§£é‡Šè¯´è¿™ä¸ªå‡½æ•°è¿™ä¹ˆåšæ˜¯æœ‰åŸå› çš„ï¼Œå› æ­¤æˆ‘å»ºè®®ä»–åœ¨å®‰è£… Sharp çš„æ—¶å€™æé†’ç”¨æˆ·å¹¶æœªä½¿ç”¨å…¨å±€å®‰è£…çš„ libvips åŒ…çš„åŸå› ï¼Œæœ€ç»ˆä½œè€…é‡‡çº³å¹¶æ¥å—äº†æˆ‘çš„æ„è§ï¼š</p>

<p><a class="link-bookmark" href="https://github.com/lovell/sharp/commit/5be36c2deb735577fc76fa52242836d40df276bd" target="_blank"><span data-bookmark-img="https://opengraph.githubassets.com/5e0efe7cbe5118b1d549459eefc68e1e3f6cac81430e4702e87cd1f5bb28616c/lovell/sharp/commit/5be36c2deb735577fc76fa52242836d40df276bd" data-bookmark-title="I"><img src="https://opengraph.githubassets.com/5e0efe7cbe5118b1d549459eefc68e1e3f6cac81430e4702e87cd1f5bb28616c/lovell/sharp/commit/5be36c2deb735577fc76fa52242836d40df276bd" /></span><span><span>Install: log Rosetta detection, improve related docs Â· lovell/sharp@5be36c2</span><span>
"High performance Node.js image processing, the fastest module to resize JPEG, PNG, WebP, AVIF and TIFF images. Uses the libvips library. - Install: log Rosetta detection, improve related docs Â· lovell/sharp@5be36c2"
</span><span>https://github.com/lovell/sharp/commit/5be36c2deb735577fc76fa52242836d40df276bd</span></span></a></p>


                <div class="text-danger">- EOF -</div>
                <div style="font-size: 12px; color: #ccc!important;">æœ¬æ–‡æœ€å…ˆå‘å¸ƒåœ¨: <a style="color: #ccc;" href="https://www.xheldon.com/tech/problem-use-sharp.html" title="ä½¿ç”¨ Sharp è½¬æ¢ HEIC/HEIF å›¾ç‰‡é‡åˆ°çš„é—®é¢˜">ä½¿ç”¨ Sharp è½¬æ¢ HEIC/HEIF å›¾ç‰‡é‡åˆ°çš„é—®é¢˜ - Xheldon Blog</a></div>
                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/life/my-2022.html" data-toggle="tooltip" data-placement="top" title="2023 å¹´å±•æœ›å’Œ 2022 å¹´å›é¡¾">
                        ä¸Šä¸€ç¯‡<br>
                        <span>2023 å¹´å±•æœ›å’Œ 2022 å¹´å›é¡¾</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/tech/prosemirror-comparison-with-slatejs.html" data-toggle="tooltip" data-placement="top" title="Slate å’Œ ProseMirror ç®€å•å¯¹æ¯”">
                        ä¸‹ä¸€ç¯‡<br>
                        <span>Slate å’Œ ProseMirror ç®€å•å¯¹æ¯”</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">
                <div class="giscus"></div>
                <hr>
            </div>  

    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section style="margin-bottom: 20px;">
    <h5>åšä¸»è¯´ï¼š</h5>
    <div>
        æˆ‘å¸¸å¸¸å¸Œæœ›åœ¨é¢å¯¹äººç”Ÿä¸­ä¸€äº›å…³é”®æŠ‰æ‹©çš„æ—¶å€™ï¼Œæœ‰äººå¯ä»¥å‘Šè¯‰æˆ‘æœ€ä½³çš„åšæ³•ï¼Œè®©æˆ‘ä¸è‡³äºç™½ç™½æµªè´¹å®è´µçš„æ—¶é—´ã€‚æ¨å·±åŠäººï¼Œæˆ‘å› æ­¤ç»å¸¸å†™åšå®¢ï¼Œä»¥æœŸåœ¨æµ©æ¸ºæ— å çš„äº’è”ç½‘ä¸­çš„è¿™ä¸ªå°å°è§’è½é‡Œè®°å½•ä¸‹å¯¹äºæˆ‘æ¥è¯´åªæœ‰ä¸€æ¬¡çš„äººç”Ÿç»å†ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åˆ°é‚£äº›å¸Œæœ›å¾—åˆ°å¸®åŠ©çš„äººã€‚
    </div>
    <hr>
    <h5><a href="/archive/">çƒ­é—¨æ ‡ç­¾</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0028" 
                    href="/archive/?tag=%E6%8A%80%E6%9C%AF"
                    title="æŠ€æœ¯"
                    rel="41">æŠ€æœ¯</a>
        
                <a data-sort="0044" 
                    href="/archive/?tag=%E7%94%9F%E6%B4%BB"
                    title="ç”Ÿæ´»"
                    rel="25">ç”Ÿæ´»</a>
        
                <a data-sort="0061" 
                    href="/archive/?tag=%E6%8A%98%E8%85%BE"
                    title="æŠ˜è…¾"
                    rel="8">æŠ˜è…¾</a>
        
                <a data-sort="0063" 
                    href="/archive/?tag=%E7%BF%BB%E8%AF%91"
                    title="ç¿»è¯‘"
                    rel="6">ç¿»è¯‘</a>
        
                <a data-sort="0064" 
                    href="/archive/?tag=%E7%BE%8E%E9%A3%9F"
                    title="ç¾é£Ÿ"
                    rel="5">ç¾é£Ÿ</a>
        
                <a data-sort="0064" 
                    href="/archive/?tag=ProseMirror"
                    title="ProseMirror"
                    rel="5">ProseMirror</a>
        
                <a data-sort="0065" 
                    href="/archive/?tag=Craft"
                    title="Craft"
                    rel="4">Craft</a>
        
                <a data-sort="0065" 
                    href="/archive/?tag=Vue"
                    title="Vue"
                    rel="4">Vue</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=%E5%88%9D%E4%BD%93%E9%AA%8C"
                    title="åˆä½“éªŒ"
                    rel="3">åˆä½“éªŒ</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=%E6%8A%80%E5%B7%A7"
                    title="æŠ€å·§"
                    rel="3">æŠ€å·§</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=%E6%8F%92%E4%BB%B6"
                    title="æ’ä»¶"
                    rel="3">æ’ä»¶</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=%E6%95%99%E7%A8%8B"
                    title="æ•™ç¨‹"
                    rel="3">æ•™ç¨‹</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=%E6%9C%8D%E5%8A%A1%E5%99%A8"
                    title="æœåŠ¡å™¨"
                    rel="3">æœåŠ¡å™¨</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=%E7%BB%8F%E9%AA%8C"
                    title="ç»éªŒ"
                    rel="3">ç»éªŒ</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=%E7%BD%91%E7%BB%9C"
                    title="ç½‘ç»œ"
                    rel="3">ç½‘ç»œ</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=%E8%8B%B9%E6%9E%9C"
                    title="è‹¹æœ"
                    rel="3">è‹¹æœ</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=%E9%9A%8F%E7%AC%94"
                    title="éšç¬”"
                    rel="3">éšç¬”</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=%E9%9B%86%E6%88%90"
                    title="é›†æˆ"
                    rel="3">é›†æˆ</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=Apple"
                    title="Apple"
                    rel="3">Apple</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=Git"
                    title="Git"
                    rel="3">Git</a>
        
                <a data-sort="0066" 
                    href="/archive/?tag=JavaScript"
                    title="JavaScript"
                    rel="3">JavaScript</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E4%B8%BB%E9%A3%9F"
                    title="ä¸»é£Ÿ"
                    rel="2">ä¸»é£Ÿ</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E4%BC%98%E5%8C%96"
                    title="ä¼˜åŒ–"
                    rel="2">ä¼˜åŒ–</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C"
                    title="ä½¿ç”¨ä½“éªŒ"
                    rel="2">ä½¿ç”¨ä½“éªŒ</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E5%A4%A7%E4%BA%8B"
                    title="å¤§äº‹"
                    rel="2">å¤§äº‹</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E5%B7%A5%E4%BD%9C%E6%B5%81"
                    title="å·¥ä½œæµ"
                    rel="2">å·¥ä½œæµ</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E6%B3%A1%E8%84%9A%E6%97%B6%E9%97%B4"
                    title="æ³¡è„šæ—¶é—´"
                    rel="2">æ³¡è„šæ—¶é—´</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E6%B5%8B%E8%AF%95"
                    title="æµ‹è¯•"
                    rel="2">æµ‹è¯•</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E7%89%B9%E6%96%AF%E6%8B%89"
                    title="ç‰¹æ–¯æ‹‰"
                    rel="2">ç‰¹æ–¯æ‹‰</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E7%BC%96%E8%BE%91%E5%99%A8"
                    title="ç¼–è¾‘å™¨"
                    rel="2">ç¼–è¾‘å™¨</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E8%B0%83%E8%AF%95"
                    title="è°ƒè¯•"
                    rel="2">è°ƒè¯•</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E8%B7%AF%E7%94%B1%E5%99%A8"
                    title="è·¯ç”±å™¨"
                    rel="2">è·¯ç”±å™¨</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E8%BD%A6"
                    title="è½¦"
                    rel="2">è½¦</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E8%BD%AF%E8%B7%AF%E7%94%B1"
                    title="è½¯è·¯ç”±"
                    rel="2">è½¯è·¯ç”±</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=%E8%BF%81%E7%A7%BB"
                    title="è¿ç§»"
                    rel="2">è¿ç§»</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=AppleScript"
                    title="AppleScript"
                    rel="2">AppleScript</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=CI"
                    title="CI"
                    rel="2">CI</a>
        
                <a data-sort="0067" 
                    href="/archive/?tag=GitHub"
                    title="GitHub"
                    rel="2">GitHub</a>
    </div>
    <hr>
    <h5>ä¸“æ </h5>
    <div class="tags">
        <a href="/projects">å¼€æºé¡¹ç›®</a>
        <a href="/book-list">æŠ€æœ¯ä¹¦å•</a>
        <a href="/subscribe">è®¢é˜…&ä»˜è´¹è½¯ä»¶</a>
        <a href="/my-food">ç¾é£Ÿæ¨è</a>
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>æœ‹å‹ä»¬</h5>
<ul class="list-inline">
  
  <li><a href="https://prosemirror.xheldon.com" target="_blank">ProseMirror ä¸­æ–‡</a></li>
  
  <li><a href="https://slate.xheldon.com" target="_blank">Slate ä¸­æ–‡</a></li>
  
  
    <li><a href="https://www.xheldon.cn" target="_blank">å›½å†…ç‰ˆ</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->


<!-- Markdown æµç¨‹å›¾æŒ‰éœ€åŠ è½½ -->


<script src="https://giscus.app/client.js"
        data-repo="Xheldon/x_blog"
        data-repo-id="MDEwOlJlcG9zaXRvcnk1MDgyODA3Ng=="
        data-category="Announcements"
        data-category-id="DIC_kwDOAweTLM4B_uhM"
        data-mapping="specific"
        data-term="ä½¿ç”¨ Sharp è½¬æ¢ HEIC/HEIF å›¾ç‰‡é‡åˆ°çš„é—®é¢˜"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://static.xheldon.cn/js/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  <!-- 
  <li>
    <a target="_blank" href="/feed.xml">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
   -->
  
  <li>
    <a target="_blank" href="https://twitter.com/_xheldon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  <li>
    <a target="_blank" href="http://weibo.com/xheldon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  
  <li>
    <a target="_blank" href="https://www.youtube.com/@xheldon">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-youtube fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  <li>
    <a target="_blank" href="https://space.bilibili.com/13835416">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-youtube-play fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
  
  <li>
    <a target="_blank" href="https://t.me/xheldon_tech">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-plane fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
</ul>
                <p class="copyright text-muted">
                    Copyright &copy; <a href="https://github.com/Xheldon" target="_blank">Xheldon</a> 2024
                    <br>
                    Don't Panic | Theme fork from <a href="https://github.com/Huxpro/huxpro.github.io" target="_blank">Hux</a>
                    <br>
                    
                </p>
            </div>
            <!-- <div class="switch-mode" id="dark-mode">
                <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                    <i class="fa fa-moon-o fa-stack-1x"></i>
                  </span>
            </div>
            <div class="switch-mode" id="light-mode">
                <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-sun-o fa-stack-1x fa-inverse"></i>
                  </span>
            </div> -->
        </div>
    </div>
</footer>
<script>
    if (window.matchMedia('(prefers-color-scheme)').media === 'not all') {
        console.log('æµè§ˆå™¨ä¸æ”¯æŒä¸»é¢˜è‰²');
    } else {
        if(window.matchMedia('(prefers-color-scheme: dark)').matches){
            document.documentElement.classList.remove('light');
            document.documentElement.classList.add('dark');
            // Note: æ¨ç‰¹åˆ—è¡¨æ·»åŠ æš—é»‘ä¸»é¢˜
            let ttl = document.querySelector('.twitter-timeline');
            if (ttl) {
                ttl.setAttribute('data-theme', 'dark');
            }
        }
        if(window.matchMedia('(prefers-color-scheme: light)').matches){
            document.documentElement.classList.remove('dark');
            document.documentElement.classList.add('light');
            let ttl = document.querySelector('.twitter-timeline');
            if (ttl) {
                ttl.removeAttribute('data-theme');
            }
        }
        // document.getElementById('dark-mode').addEventListener('click', function() {
        //     document.documentElement.classList.remove('light');
        //     document.documentElement.classList.add('dark');
        // });
        // document.getElementById('light-mode').addEventListener('click', function() {
        //     document.documentElement.classList.add('light');
        //     document.documentElement.classList.remove('dark');
        // });
        // Note: è‡ªåŠ¨åˆ‡æ¢
        window.matchMedia('(prefers-color-scheme: dark)').addListener(function(mediaQueryList) {
            if (mediaQueryList.matches) {
                document.documentElement.classList.add('dark');
                document.documentElement.classList.remove('light');
            }
        })
        window.matchMedia('(prefers-color-scheme: light)').addListener(function(mediaQueryList) {
            if (mediaQueryList.matches) {
                document.documentElement.classList.add('light');
                document.documentElement.classList.remove('dark');
            }
        })
    }
</script>
<!-- jQuery -->
<script src="https://static.xheldon.cn/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="https://static.xheldon.cn/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="https://static.xheldon.cn/js/xheldon-life-blog.min.js?202110012319"></script>

<!-- Simple Jekyll Search -->
<script src="https://static.xheldon.cn/js/simple-jekyll-search.min.js"></script>

<!-- Vercel web analysis -->

<script defer src="/_vercel/insights/script.js"></script>

<!-- Service Worker -->

<script src="https://static.xheldon.cn/js/snackbar.js "></script>
<script src="https://static.xheldon.cn/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>






<!--fastClick.js -->
<script>
    async("https://static.xheldon.cn/js/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-79359216-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-79359216-1');
</script>


<!-- Side Catalog -->



<!-- Multi-Lingual -->


<!-- Simple Jekyll Search -->
<script>
    // https://stackoverflow.com/questions/1912501/unescape-html-entities-in-javascript
    function htmlDecode(input) {
        var e = document.createElement('textarea');
        e.innerHTML = input;
        // handle case of empty input
        return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
    }

    SimpleJekyllSearch({
        searchInput: document.getElementById('search-input'),
        resultsContainer: document.getElementById('search-results'),
        json: '/search.json',
        searchResultTemplate: '<div class="post-preview item"><a href="{url}"><h2 class="post-title">{title}</h2><h3 class="post-subtitle">{subtitle}</h3><hr></a></div>',
        noResultsText: 'No results',
        limit: 50,
        fuzzy: false,
        // a hack to get escaped subtitle unescaped. for some reason, 
        // post.subtitle w/o escape filter nuke entire search.
        templateMiddleware: function (prop, value, template) {
            if (prop === 'subtitle' || prop === 'title') {
                if (value.indexOf("code")) {
                    return htmlDecode(value);
                } else {
                    return value;
                }
            }
        }
    });

    $(document).ready(function () {
        var $searchPage = $('.search-page');
        var $searchOpen = $('.search-icon');
        var $searchClose = $('.search-icon-close');
        var $searchInput = $('#search-input');
        var $body = $('body');

        $searchOpen.on('click', function (e) {
            e.preventDefault();
            $searchPage.toggleClass('search-active');
            var prevClasses = $body.attr('class') || '';
            setTimeout(function () {
                $body.addClass('no-scroll');
            }, 400)

            if ($searchPage.hasClass('search-active')) {
                $searchClose.on('click', function (e) {
                    e.preventDefault();
                    $searchPage.removeClass('search-active');
                    $body.attr('class', prevClasses);  // from closure 
                });
                $searchInput.focus();
            }
        });
    });
</script>


<!-- Image to hack wechat -->
<img src="/resources/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
